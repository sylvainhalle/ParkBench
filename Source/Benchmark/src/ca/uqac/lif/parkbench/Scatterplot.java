package ca.uqac.lif.parkbench;

import java.util.HashSet;
import java.util.Set;

public class Scatterplot extends GnuPlot
{
	/**
	 * The name of the parameter to use as the "x" value of the plot
	 */
	protected String m_paramNameX = "";
	
	/**
	 * The name of the parameter to use as the "y" value of the plot
	 */
	protected String m_paramNameY = "";
	
	/**
	 * The caption for the x-axis
	 */
	protected String m_captionX = "";
	
	/**
	 * The caption for the y-axis
	 */
	protected String m_captionY = "";
	
	/**
	 * Creates an empty scatterplot with title
	 * @param title The title
	 */
	public Scatterplot(String title)
	{
		super(title);
	}
	
	/**
	 * Set the name of the parameter to use as the "x" value of the
	 * plot
	 * @param name The parameter name
	 */
	public void setParameterX(String name)
	{
		m_paramNameX = name;
	}

	/**
	 * Set the name of the parameter to use as the "y" value of the
	 * plot
	 * @param name The parameter name
	 */
	public void setParameterY(String name)
	{
		m_paramNameY = name;
	}
	
	@Override
	public String toGnuPlot(Terminal term)
	{
		// Build the set of parameters to group by (x)
		Set<String> group_by = new HashSet<String>();
		group_by.add(m_paramNameX);
		// Fill a 2D map with data
		Map2D<Number,Parameters,Number> map = new Map2D<Number,Parameters,Number>();
		for (Test t : m_tests)
		{
			Parameters params = new Parameters(t.getParameters());
			Number value_x = (Number) params.get(m_paramNameX);
			params.removeAll(group_by);
			Parameters results = t.getResults();
			Number value_y = (Number) results.getNumber(m_paramNameY);
			map.put(value_x, params, value_y);
		}
		// Create plot string
		StringBuilder out = new StringBuilder();
		out.append("# File auto-generated by ParkBench\n");
		out.append("set terminal ").append(term).append("\n");
		out.append("set title \"").append(m_title).append("\"\n");
		out.append("set x-axis title \"").append(m_captionX).append("\"\n");
		out.append("set y-axis title \"").append(m_captionX).append("\"\n");
		out.append(map.toCsv());
		return out.toString();
	}
}
